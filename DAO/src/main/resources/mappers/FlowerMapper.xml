<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--命名空间应该是对应接口的包名+接口名 -->
<mapper namespace="com.nf511.flower.dao.FlowerDAO">

    <select id="getFlower" resultMap="Flower_All" parameterType="map">
        SELECT * FROM
        flower f,floweruse fu,flowertype ft,flowerbranchnumber fb,state s
        <where>
            f.flowerUseId=fu.flowerUseId AND f.flowerTypeId=ft.flowerTypeId AND
            f.flowerBranchNumberId=fb.flowerBranchNumberId AND f.stateId=s.stateId

            <if test="flowerId!=null and flowerId!=''">
                and f.flowerId=#{flowerId}
            </if>
            <if test="flowerUseName!=null and flowerUseName!=''">
                and fu.flowerUseName=#{flowerUseName}
            </if>
            <if test="flowerTypeName!=null and flowerTypeName!=''">
                and ft.flowerTypeName=#{flowerTypeName}
            </if>
            <if test="flowerBranchNumber!=null and flowerBranchNumber!=''">
                and fb.flowerBranchNumber=#{flowerBranchNumber}
            </if>
            <if test="flowerMaterials!=null and flowerMaterials!=''">
                and f.flowerMaterials like concat(concat('%',#{flowerMaterials}),'%')
            </if>

        </where>
        ORDER BY flowerDateTime DESC limit #{skip},#{size}
    </select>
    <resultMap id="Flower_All" type="Flower">
        <id property="flowerId" column="flowerId"></id>
        <result property="flowerTypeId" column="flowerTypeId"></result>
        <result property="flowerUseId" column="flowerUseId"></result>
        <result property="flowerBranchNumberId" column="flowerBranchNumberId"></result>
        <result property="flowerMarketPrice" column="flowerMarketPrice"></result>
        <result property="flowerPrice" column="flowerPrice"></result>
        <result property="flowerInventory" column="flowerInventory"></result>
        <result property="flowerImageName" column="flowerImageName"></result>
        <result property="flowerName" column="flowerName"></result>
        <result property="flowerDateTime" column="flowerDateTime"></result>
        <result property="flowerMaterials" column="flowerMaterials"></result>
        <result property="flowerPackaging" column="flowerPackaging"></result>
        <result property="flowerLanguage" column="flowerLanguage"></result>
        <result property="flowerIntroduce" column="flowerIntroduce"></result>
        <result property="stateId" column="stateId"></result>
        <!--映射关系，指定属性与属性的类型-->
        <association property="flowertype" javaType="Flowertype">
            <id property="flowerTypeId" column="flowerTypeId"></id>
            <result property="flowerTypeName" column="flowerTypeName"></result>
        </association>
        <association property="floweruse" javaType="Floweruse">
            <id property="flowerUseId" column="flowerUseId"></id>
            <result property="flowerUseName" column="flowerUseName"></result>
        </association>
        <association property="flowerbranchnumber" javaType="Flowerbranchnumber">
            <id property="flowerBranchNumberId" column="flowerBranchNumberId"></id>
            <result property="flowerBranchNumber" column="flowerBranchNumber"></result>
        </association>
        <association property="state" javaType="State">
            <id property="stateId" column="stateId"></id>
            <result property="stateName" column="stateName"></result>
        </association>
    </resultMap>

    <select id="getFlowerCount" resultType="int">
        select count(*) from flower f,floweruse fu,flowertype ft,flowerbranchnumber fb,state s
        <where>
            f.flowerUseId=fu.flowerUseId AND f.flowerTypeId=ft.flowerTypeId AND
            f.flowerBranchNumberId=fb.flowerBranchNumberId AND f.stateId=s.stateId

            <if test="flowerUseName!=null and flowerUseName!=''">
                and fu.flowerUseName=#{flowerUseName}
            </if>
            <if test="flowerTypeName!=null and flowerTypeName!=''">
                and ft.flowerTypeName=#{flowerTypeName}
            </if>
            <if test="flowerBranchNumber!=null and flowerBranchNumber!=''">
                and fb.flowerBranchNumber=#{flowerBranchNumber}
            </if>
            <if test="flowerMaterials!=null and flowerMaterials!=''">
                and f.flowerMaterials like concat(concat('%',#{flowerMaterials}),'%')
            </if>

        </where>
    </select>

</mapper>